<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† â€” RBT</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --teal:#17bdb6;
      --accent:#ff9800;
      --bg:#f3f6f8;
      --card:#ffffff;
      --muted:#7b8a91;
      --glass-bg: rgba(255,255,255,0.72);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:'Tajawal',sans-serif;background:linear-gradient(180deg,#eef6f6,#f7fbfb);color:#123;}
    /* Header top with turquoise like app */
    .topbar{
      background:var(--teal);
      color:#fff;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      position:sticky;
      top:0;
      z-index:50;
    }
    .topbar .title{font-weight:700;font-size:18px}
    .topbar .top-actions{display:flex;gap:8px;align-items:center}
    .icon-btn{
      background:rgba(255,255,255,0.14);
      border:none;
      color:#fff;
      padding:8px 10px;
      border-radius:999px;
      font-size:18px;
      cursor:pointer;
      box-shadow:0 2px 8px rgba(0,0,0,0.08);
    }
    /* page container */
    .wrap{max-width:920px;margin:18px auto;padding:0 14px 80px;}
    /* top quick buttons (inside page) */
    .quick-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-bottom:16px}
    .quick-btn{
      background:var(--glass-bg);
      border-radius:14px;padding:10px 14px;border:1px solid rgba(0,0,0,0.04);
      box-shadow:0 6px 18px rgba(0,0,0,0.06);cursor:pointer;font-weight:700;color:#0b2f2d;
      display:flex;align-items:center;gap:8px;
    }
    /* main card style */
    .card{background:var(--card);border-radius:16px;padding:14px;margin-bottom:18px;box-shadow:0 10px 30px rgba(13,38,41,0.06);}
    .card h2{margin:0 0 10px 0;color:var(--teal);font-size:18px}
    label{display:block;font-weight:600;margin-bottom:6px;color:#234}
    input[type="text"], input[type="url"], textarea, select, input[type="time"]{
      width:100%;padding:10px;border-radius:10px;border:1px solid #e0e6e6;font-size:14px;margin-bottom:10px;
    }
    textarea{min-height:72px;resize:vertical}
    .small-muted{color:var(--muted);font-size:13px}
    .row{display:flex;gap:10px;align-items:center}
    .row .flex{flex:1}
    .btn-primary{background:var(--accent);color:#fff;border:none;padding:12px;border-radius:12px;font-weight:700;cursor:pointer;box-shadow:0 8px 20px rgba(255,152,0,0.18)}
    .btn-neutral{background:var(--glass-bg);border:none;padding:10px;border-radius:12px;cursor:pointer}
    .form-actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
    /* preview box */
    .preview-box{margin-top:8px}
    .preview-box img, .preview-box video, .preview-box iframe{max-width:100%;border-radius:8px;display:block}
    /* users table */
    table{width:100%;border-collapse:collapse;margin-top:6px}
    th,td{padding:10px;border-bottom:1px solid #eef2f2;text-align:center;font-size:14px}
    th{background:transparent;color:var(--muted);font-weight:700}
    .user-btn{padding:6px 8px;border-radius:8px;border:none;cursor:pointer;margin:2px}
    .user-btn.delete{background:#ffecec;color:#a00}
    .user-btn.promote{background:#e6fff9;color:#046852}
    .user-btn.demote{background:#fff4e6;color:#924600}
    /* glass modal */
    .modal{
      position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);
      z-index:2000;opacity:0;pointer-events:none;transition:opacity .22s ease;
    }
    .modal.active{opacity:1;pointer-events:auto}
    .modal-card{
      width:92%;max-width:420px;background:rgba(255,255,255,0.78);backdrop-filter:blur(10px);
      border-radius:14px;padding:14px;box-shadow:0 24px 60px rgba(10,20,20,0.15);transform:translateY(8px) scale(.96);
      animation:popIn .28s cubic-bezier(.2,.9,.2,1) forwards;
      max-height:80vh;overflow:auto;
    }
    @keyframes popIn{to{transform:translateY(0) scale(1)}}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .modal .close{background:transparent;border:none;font-size:22px;cursor:pointer;color:#234}
    .checkbox-grid{display:grid;gap:8px;margin-top:8px}
    .checkbox-grid.days{grid-template-columns:repeat(4,1fr)}
    .checkbox-grid.months{grid-template-columns:repeat(3,1fr)}
    .checkbox-grid label{background:#fff;border-radius:10px;padding:8px 6px;display:flex;align-items:center;gap:8px;border:1px solid #f0f4f4}
    .save-small{background:var(--teal);color:#fff;border:none;padding:8px 12px;border-radius:10px;cursor:pointer;margin-top:10px;font-weight:700}
    /* footer saved summary */
    .summary{background:linear-gradient(90deg,rgba(23,189,182,0.08),rgba(255,152,0,0.04));padding:10px;border-radius:12px;font-size:14px;color:#123;margin-top:8px}
    /* responsive */
    @media (max-width:600px){
      .checkbox-grid.days{grid-template-columns:repeat(4,1fr)}
      .checkbox-grid.months{grid-template-columns:repeat(3,1fr)}
      .modal-card{max-width:94%}
      .quick-row{gap:8px}
    }
  </style>
</head>
<body>

  <!-- TOP BAR (turquoise) -->
  <div class="topbar">
    <div class="title">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† â€” RBT</div>
    <div class="top-actions">
      <button class="icon-btn" title="Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª" onclick="location.href='notifications.html'">ğŸ””</button>
      <button class="icon-btn" title="Ø­Ø³Ø§Ø¨ÙŠ" onclick="location.href='profile.html'">âš™ï¸</button>
    </div>
  </div>

  <div class="wrap">

    <!-- Quick buttons (inside page) -->
    <div class="quick-row">
      <button class="quick-btn" onclick="location.href='chatrooms.html'">ğŸ’¬ Ù‚Ø§Ø¹Ø§Øª Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
      <button class="quick-btn" onclick="location.href='strategy.html'">ğŸ“‹ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„Ø¹Ù…Ù„</button>
      <button class="quick-btn" onclick="location.href='promotion-requests.html'">ğŸ“ˆ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø±ØªÙ‚Ø§Ø¡</button>
      <button class="quick-btn" onclick="location.href='messages.html'">âœ‰ï¸ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†</button>
    </div>

    <!-- storage link -->
    <div style="display:flex;justify-content:flex-end;margin-bottom:8px">
      <a href="storage.html" style="text-decoration:none;color:var(--muted);font-weight:700">ğŸ’¾ ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ÙˆØ§Ù„ÙƒÙˆÙŠØ²Ø§Øª</a>
    </div>

    <!-- Post programming -->
    <div class="card" id="post-section">
      <h2>Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª</h2>

      <form id="postForm" onsubmit="handleSavePost(event)">
        <label>ØµÙˆØ±Ø©/ÙÙŠØ¯ÙŠÙˆ/Ø±Ø§Ø¨Ø· Ø£Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
        <input type="file" id="postMediaInput" accept="image/*,video/*">
        <input type="url" id="postLinkInput" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ Ù…ÙˆÙ‚Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">

        <div class="preview-box" id="postPreview"></div>

        <label>Ù†Øµ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</label>
        <textarea id="postText" placeholder="Ù†Øµ Ø§Ù„Ù…Ù†Ø´ÙˆØ±..." required></textarea>

        <label>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø§Ø¹Ø©</label>
        <select id="postRoom">
          <option value="marketers">Ù‚Ø§Ø¹Ø© Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ†</option>
          <option value="ambassadors">Ù‚Ø§Ø¹Ø© Ø§Ù„Ø³ÙØ±Ø§Ø¡</option>
          <option value="leaders">Ù‚Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ø©</option>
        </select>

        <div class="row">
          <div class="flex">
            <label>ÙˆÙ‚Øª Ø£ÙˆÙ„ Ù†Ø´Ø±</label>
            <input type="time" id="postFirstTime" required>
            <div class="small-muted">Ø§Ù„ØªÙƒØ±Ø§Ø± ÙƒÙ„ 3 Ø³Ø§Ø¹Ø§Øª (Ø³ÙŠØªÙ… Ø§Ø¹ØªÙ…Ø§Ø¯ ÙØ§ØµÙ„ 3 Ø³Ø§Ø¹Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹)</div>
          </div>
        </div>

        <div class="row" style="margin-top:8px;">
          <button type="button" class="glass-btn" onclick="openModal('postDaysModal')">ğŸ“… Ø£ÙŠØ§Ù… Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø´Ù‡Ø±</button>
          <button type="button" class="glass-btn" onclick="openModal('postMonthsModal')">ğŸ—“ï¸ Ø£Ø´Ù‡Ø± Ø§Ù„Ù†Ø´Ø±</button>
        </div>

        <div class="form-actions">
          <button class="btn-primary" type="submit">Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</button>
          <button type="button" class="btn-neutral" onclick="resetPostForm()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
        </div>

        <div id="postSavedMsg" class="summary" style="display:none;margin-top:12px"></div>
      </form>
    </div>

    <!-- Quiz programming -->
    <div class="card" id="quiz-section">
      <h2>Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ (Quiz)</h2>

      <form id="quizForm" onsubmit="handleSaveQuiz(event)">
        <label>ØµÙˆØ±Ø©/ÙÙŠØ¯ÙŠÙˆ/Ø±Ø§Ø¨Ø· Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆÙŠØ²</label>
        <input type="file" id="quizMediaInput" accept="image/*,video/*">
        <input type="url" id="quizLinkInput" placeholder="Ø±Ø§Ø¨Ø· ÙŠÙˆØªÙŠÙˆØ¨ Ø£Ùˆ Ù…ÙˆÙ‚Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
        <div class="preview-box" id="quizPreview"></div>

        <label>Ø§Ù„Ø³Ø¤Ø§Ù„</label>
        <textarea id="quizQuestion" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„..." required></textarea>

        <label>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©</label>
        <input type="text" id="opt1" placeholder="Ø®ÙŠØ§Ø± 1" required>
        <input type="text" id="opt2" placeholder="Ø®ÙŠØ§Ø± 2" required>
        <input type="text" id="opt3" placeholder="Ø®ÙŠØ§Ø± 3">
        <input type="text" id="opt4" placeholder="Ø®ÙŠØ§Ø± 4">

        <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
        <select id="correctOpt" required>
          <option value="1">Ø®ÙŠØ§Ø± 1</option>
          <option value="2">Ø®ÙŠØ§Ø± 2</option>
          <option value="3">Ø®ÙŠØ§Ø± 3</option>
          <option value="4">Ø®ÙŠØ§Ø± 4</option>
        </select>

        <label>Ø±ØªØ¨Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</label>
        <select id="quizRank">
          <option value="marketer">Ù…Ø³ÙˆÙ‚</option>
          <option value="ambassador">Ø³ÙÙŠØ±</option>
          <option value="leader">Ù‚Ø§Ø¦Ø¯</option>
        </select>

        <div class="row" style="margin-top:8px;">
          <button type="button" class="glass-btn" onclick="openModal('quizDaysModal')">ğŸ“… Ø£ÙŠØ§Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„ÙƒÙˆÙŠØ²</button>
          <button type="button" class="glass-btn" onclick="openModal('quizMonthsModal')">ğŸ—“ï¸ Ø£Ø´Ù‡Ø± ØªÙƒØ±Ø§Ø± Ø§Ù„ÙƒÙˆÙŠØ²</button>
        </div>

        <div class="form-actions">
          <button class="btn-primary" type="submit">Ø­ÙØ¸ Ø§Ù„ØªØ¯Ø±ÙŠØ¨</button>
          <button type="button" class="btn-neutral" onclick="resetQuizForm()">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
        </div>

        <div id="quizSavedMsg" class="summary" style="display:none;margin-top:12px"></div>
      </form>
    </div>

    <!-- Users -->
    <div class="card" id="manage-users">
      <h2>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
      <table aria-label="users table">
        <thead>
          <tr><th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th><th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th><th>Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th><th>Ù‚Ø§Ø¹Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</th><th>Ø§Ù„ØªØ­ÙƒÙ…</th></tr>
        </thead>
        <tbody id="userTable"></tbody>
      </table>
    </div>

  </div> <!-- wrap -->

  <!-- MODALS (post days/months & quiz days/months) -->
  <div class="modal" id="postDaysModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <strong>ğŸ“… Ø£ÙŠØ§Ù… Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø´Ù‡Ø±</strong>
        <button class="close" onclick="closeModal('postDaysModal')">Ã—</button>
      </div>
      <div class="checkbox-grid days" id="postDaysGrid"></div>
      <button class="save-small" onclick="saveModalSelection('postDays')">Ø­ÙØ¸</button>
    </div>
  </div>

  <div class="modal" id="postMonthsModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <strong>ğŸ—“ï¸ Ø£Ø´Ù‡Ø± Ø§Ù„Ù†Ø´Ø±</strong>
        <button class="close" onclick="closeModal('postMonthsModal')">Ã—</button>
      </div>
      <div class="checkbox-grid months" id="postMonthsGrid"></div>
      <button class="save-small" onclick="saveModalSelection('postMonths')">Ø­ÙØ¸</button>
    </div>
  </div>

  <div class="modal" id="quizDaysModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <strong>ğŸ“… Ø£ÙŠØ§Ù… ØªÙƒØ±Ø§Ø± Ø§Ù„ÙƒÙˆÙŠØ²</strong>
        <button class="close" onclick="closeModal('quizDaysModal')">Ã—</button>
      </div>
      <div class="checkbox-grid days" id="quizDaysGrid"></div>
      <button class="save-small" onclick="saveModalSelection('quizDays')">Ø­ÙØ¸</button>
    </div>
  </div>

  <div class="modal" id="quizMonthsModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <strong>ğŸ—“ï¸ Ø£Ø´Ù‡Ø± ØªÙƒØ±Ø§Ø± Ø§Ù„ÙƒÙˆÙŠØ²</strong>
        <button class="close" onclick="closeModal('quizMonthsModal')">Ã—</button>
      </div>
      <div class="checkbox-grid months" id="quizMonthsGrid"></div>
      <button class="save-small" onclick="saveModalSelection('quizMonths')">Ø­ÙØ¸</button>
    </div>
  </div>

<script>
/* -------------------------
   Utilities & modal logic
   ------------------------- */
function openModal(id){
  document.getElementById(id).classList.add('active');
}
function closeModal(id){
  document.getElementById(id).classList.remove('active');
}
document.querySelectorAll('.modal').forEach(m=>{
  m.addEventListener('click', e=>{
    if(e.target === m) m.classList.remove('active');
  });
});

/* -------------------------
   Fill days/months grids
   ------------------------- */
const daysArr = Array.from({length:31},(_,i)=>i+1);
const monthsArr = ['ÙŠÙ†Ø§ÙŠØ±','ÙØ¨Ø±Ø§ÙŠØ±','Ù…Ø§Ø±Ø³','Ø£Ø¨Ø±ÙŠÙ„','Ù…Ø§ÙŠÙˆ','ÙŠÙˆÙ†ÙŠÙˆ','ÙŠÙˆÙ„ÙŠÙˆ','Ø£ØºØ³Ø·Ø³','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];

function renderGrid(containerId, items, type){
  const el = document.getElementById(containerId);
  el.innerHTML = '';
  items.forEach((it, idx)=>{
    const label = document.createElement('label');
    const val = (type==='month') ? (idx+1) : it;
    label.innerHTML = `<input type="checkbox" value="${val}"> ${it}`;
    el.appendChild(label);
  });
}

renderGrid('postDaysGrid', daysArr, 'day');
renderGrid('quizDaysGrid', daysArr.slice(0,28), 'day'); // quiz days up to 28
renderGrid('postMonthsGrid', monthsArr, 'month');
renderGrid('quizMonthsGrid', monthsArr, 'month');

/* -------------------------
   Persist selections in localStorage
   ------------------------- */
function saveModalSelection(key){
  // key: 'postDays' or 'postMonths' or 'quizDays' or 'quizMonths'
  let gridId;
  if(key==='postDays') gridId='postDaysGrid';
  else if(key==='postMonths') gridId='postMonthsGrid';
  else if(key==='quizDays') gridId='quizDaysGrid';
  else if(key==='quizMonths') gridId='quizMonthsGrid';
  const checks = Array.from(document.getElementById(gridId).querySelectorAll('input[type=checkbox]'));
  const selected = checks.filter(c=>c.checked).map(c=>c.value);
  localStorage.setItem('rbt_'+key, JSON.stringify(selected));
  // feedback + close modal
  alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª.');
  // close the modal
  if(key==='postDays') closeModal('postDaysModal');
  if(key==='postMonths') closeModal('postMonthsModal');
  if(key==='quizDays') closeModal('quizDaysModal');
  if(key==='quizMonths') closeModal('quizMonthsModal');
  renderSavedSummary();
}

/* restore */
function restoreSelections(){
  ['postDays','postMonths','quizDays','quizMonths'].forEach(k=>{
    const data = JSON.parse(localStorage.getItem('rbt_'+k) || '[]');
    let gridId = k==='postMonths' ? 'postMonthsGrid' : k==='quizMonths' ? 'quizMonthsGrid' : k==='postDays' ? 'postDaysGrid' : 'quizDaysGrid';
    const checkInputs = Array.from(document.getElementById(gridId).querySelectorAll('input[type=checkbox]'));
    checkInputs.forEach(inp=>{
      inp.checked = data.includes(String(inp.value));
    });
  });
}
restoreSelections();

/* show small summary under forms */
function renderSavedSummary(){
  const pDays = JSON.parse(localStorage.getItem('rbt_postDays')||'[]');
  const pMonths = JSON.parse(localStorage.getItem('rbt_postMonths')||'[]');
  const qDays = JSON.parse(localStorage.getItem('rbt_quizDays')||'[]');
  const qMonths = JSON.parse(localStorage.getItem('rbt_quizMonths')||'[]');

  const postMsg = document.getElementById('postSavedMsg');
  postMsg.style.display = (pDays.length||pMonths.length)?'block':'none';
  postMsg.innerText = `Ø£ÙŠØ§Ù…: ${pDays.join(', ') || 'â€”'}  â€¢  Ø£Ø´Ù‡Ø±: ${pMonths.map(m=>monthsArr[m-1]).join(', ') || 'â€”'}`;

  const quizMsg = document.getElementById('quizSavedMsg');
  quizMsg.style.display = (qDays.length||qMonths.length)?'block':'none';
  quizMsg.innerText = `Ø£ÙŠØ§Ù…: ${qDays.join(', ') || 'â€”'}  â€¢  Ø£Ø´Ù‡Ø±: ${qMonths.map(m=>monthsArr[m-1]).join(', ') || 'â€”'}`;
}
renderSavedSummary();

/* -------------------------
   Media preview for Post & Quiz
   ------------------------- */
function previewMedia(fileInput, linkInput, previewBox){
  previewBox.innerHTML='';
  if(fileInput && fileInput.files && fileInput.files[0]){
    const file = fileInput.files[0];
    if(file.type.startsWith('image/')){
      const img = document.createElement('img'); img.src=URL.createObjectURL(file); previewBox.appendChild(img);
    } else if(file.type.startsWith('video/')){
      const v = document.createElement('video'); v.src=URL.createObjectURL(file); v.controls=true; previewBox.appendChild(v);
    }
  } else if(linkInput && linkInput.value){
    // show iframe if youtube or url
    const iframe = document.createElement('iframe');
    iframe.src = linkInput.value;
    iframe.width = '100%'; iframe.height = 180; iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    previewBox.appendChild(iframe);
  }
}
const postMediaInput = document.getElementById('postMediaInput'), postLinkInput = document.getElementById('postLinkInput'), postPreview = document.getElementById('postPreview');
postMediaInput.addEventListener('change', ()=>previewMedia(postMediaInput, postLinkInput, postPreview));
postLinkInput.addEventListener('input', ()=>previewMedia(postMediaInput, postLinkInput, postPreview));

const quizMediaInput = document.getElementById('quizMediaInput'), quizLinkInput = document.getElementById('quizLinkInput'), quizPreview = document.getElementById('quizPreview');
quizMediaInput.addEventListener('change', ()=>previewMedia(quizMediaInput, quizLinkInput, quizPreview));
quizLinkInput.addEventListener('input', ()=>previewMedia(quizMediaInput, quizLinkInput, quizPreview));

/* -------------------------
   Save post & quiz (local only for demo)
   ------------------------- */
function handleSavePost(e){
  e.preventDefault();
  const post = {
    text: document.getElementById('postText').value,
    room: document.getElementById('postRoom').value,
    firstTime: document.getElementById('postFirstTime').value,
    days: JSON.parse(localStorage.getItem('rbt_postDays')||'[]'),
    months: JSON.parse(localStorage.getItem('rbt_postMonths')||'[]'),
    savedAt: new Date().toISOString()
  };
  // for demo we store posts in localStorage array
  const all = JSON.parse(localStorage.getItem('rbt_posts')||'[]'); all.push(post); localStorage.setItem('rbt_posts', JSON.stringify(all));
  document.getElementById('postSavedMsg').style.display='block';
  document.getElementById('postSavedMsg').innerText = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù…Ø­Ù„ÙŠÙ‹Ø§. (Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… ØªØ­ØªØ§Ø¬ backend)';
}

function handleSaveQuiz(e){
  e.preventDefault();
  const quiz = {
    question: document.getElementById('quizQuestion').value,
    opts: [document.getElementById('opt1').value, document.getElementById('opt2').value, document.getElementById('opt3').value, document.getElementById('opt4').value],
    correct: document.getElementById('correctOpt').value,
    rank: document.getElementById('quizRank').value,
    days: JSON.parse(localStorage.getItem('rbt_quizDays')||'[]'),
    months: JSON.parse(localStorage.getItem('rbt_quizMonths')||'[]'),
    savedAt: new Date().toISOString()
  };
  const all = JSON.parse(localStorage.getItem('rbt_quizzes')||'[]'); all.push(quiz); localStorage.setItem('rbt_quizzes', JSON.stringify(all));
  document.getElementById('quizSavedMsg').style.display='block';
  document.getElementById('quizSavedMsg').innerText = 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ù…Ø­Ù„ÙŠÙ‹Ø§.';
}

/* reset helpers */
function resetPostForm(){
  document.getElementById('postForm').reset(); postPreview.innerHTML=''; localStorage.removeItem('rbt_posts_preview');
}
function resetQuizForm(){
  document.getElementById('quizForm').reset(); quizPreview.innerHTML=''; localStorage.removeItem('rbt_quizzes_preview');
}

/* -------------------------
   Users demo & actions
   ------------------------- */
const users = [
  {name:"Ali", email:"ali@example.com", rank:"Ù…Ø³ÙˆÙ‚", room:"Ù‚Ø§Ø¹Ø© Ø§Ù„Ù…Ø³ÙˆÙ‚ÙŠÙ†"},
  {name:"Sara", email:"sara@example.com", rank:"Ø³ÙÙŠØ±", room:"Ù‚Ø§Ø¹Ø© Ø§Ù„Ø³ÙØ±Ø§Ø¡"},
  {name:"Khalid", email:"khalid@example.com", rank:"Ù‚Ø§Ø¦Ø¯", room:"Ù‚Ø§Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ø©"}
];
function renderUsers(){
  const tbody = document.getElementById('userTable'); tbody.innerHTML='';
  users.forEach((u,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.name}</td><td>${u.email}</td><td>${u.rank}</td><td>${u.room}</td>
      <td>
        <button class="user-btn delete" onclick="deleteUser(${i})">Ø­Ø°Ù</button>
        <button class="user-btn promote" onclick="promoteUser(${i})">ØªØ±Ù‚ÙŠØ©</button>
        <button class="user-btn demote" onclick="demoteUser(${i})">Ø¥Ø¹Ø§Ø¯Ø© Ø±ØªØ¨Ø©</button>
      </td>`;
    tbody.appendChild(tr);
  });
}
function deleteUser(i){ if(confirm('ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')){ users.splice(i,1); renderUsers(); } }
function promoteUser(i){
  const order = ['Ù…Ø³ÙˆÙ‚','Ø³ÙÙŠØ±','Ù‚Ø§Ø¦Ø¯'];
  const idx = order.indexOf(users[i].rank);
  if(idx < order.length-1){ users[i].rank = order[idx+1]; renderUsers(); } else alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø±ØªØ¨Ø©.');
}
function demoteUser(i){
  const order = ['Ù…Ø³ÙˆÙ‚','Ø³ÙÙŠØ±','Ù‚Ø§Ø¦Ø¯'];
  const idx = order.indexOf(users[i].rank);
  if(idx > 0){ users[i].rank = order[idx-1]; renderUsers(); } else alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø£Ø¯Ù†Ù‰ Ø±ØªØ¨Ø©.');
}
renderUsers();

/* -------------------------
   initialize summary and restore
   ------------------------- */
renderSavedSummary();
restoreSelections();

</script>
</body>
</html>
